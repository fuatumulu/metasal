generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Admin {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  createdAt DateTime @default(now())
}

// Vision Antidetect Browser Profilleri
model VisionProfile {
  id           Int                  @id @default(autoincrement())
  visionId     String               @unique  // Vision API'dan gelen UUID
  folderId     String                        // Vision API'dan gelen Folder UUID
  name         String                        // Profil adı
  status       String               @default("active") // active, disabled
  lastSyncedAt DateTime?
  createdAt    DateTime             @default(now())
  likedTargets ProfileLikedTarget[]
  tasks        BotTask[]
}

// Profillerin beğendiği hedefler (tekrar beğenmeyi önlemek için)
model ProfileLikedTarget {
  id        Int           @id @default(autoincrement())
  profile   VisionProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)
  profileId Int
  target    Target        @relation(fields: [targetId], references: [id], onDelete: Cascade)
  targetId  Int
  likedAt   DateTime      @default(now())

  @@unique([profileId, targetId])
}

model Target {
  id           Int                  @id @default(autoincrement())
  type         String               // page, group
  url          String
  name         String?
  status       String               @default("pending") // pending, completed, failed
  isActive     Boolean              @default(true)
  createdAt    DateTime             @default(now())
  likedBy      ProfileLikedTarget[]
  tasks        BotTask[]
}

model PostTask {
  id             Int       @id @default(autoincrement())
  searchKeyword  String    // Gönderide aranacak kelime öbeği
  targetLikes    Int       @default(0)
  targetComments Int       @default(0)
  targetShares   Int       @default(0)
  doneLikes      Int       @default(0)
  doneComments   Int       @default(0)
  doneShares     Int       @default(0)
  status         String    @default("pending") // pending, in_progress, completed, failed
  createdAt      DateTime  @default(now())
  tasks          BotTask[]
}

model Comment {
  id        Int      @id @default(autoincrement())
  text      String   @db.Text
  usedCount Int      @default(0)
  createdAt DateTime @default(now())
}

model BotTask {
  id         Int            @id @default(autoincrement())
  profile    VisionProfile? @relation(fields: [profileId], references: [id], onDelete: Cascade)
  profileId  Int?
  taskType   String         // like_target, post_action
  target     Target?        @relation(fields: [targetId], references: [id], onDelete: Cascade)
  targetId   Int?
  postTask   PostTask?      @relation(fields: [postTaskId], references: [id], onDelete: Cascade)
  postTaskId Int?
  status     String         @default("pending") // pending, processing, completed, failed
  result     String?        @db.Text
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
}
