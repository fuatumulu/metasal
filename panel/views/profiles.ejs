<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetaSal - Profiller</title>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <nav class="sidebar">
        <div class="sidebar-header">
            <h2>MetaSal</h2>
        </div>
        <ul class="nav-links">
            <li>
                <a href="/dashboard">üìä Dashboard</a>
            </li>
            <li class="active">
                <a href="/profiles">üñ•Ô∏è Profiller</a>
            </li>
            <li>
                <a href="/targets">üìÑ Gruplar/Sayfalar</a>
            </li>
            <li>
                <a href="/posts">üìù G√∂nderiler</a>
            </li>
            <li>
                <a href="/comments">üí¨ Yorumlar</a>
            </li>
        </ul>
        <div class="sidebar-footer">
            <a href="/logout" class="logout-btn">üö™ √áƒ±kƒ±≈ü</a>
        </div>
    </nav>

    <main class="content">
        <div class="page-header">
            <h1>Vision Profilleri</h1>
            <p style="color:#666;margin-top:5px">Vision Antidetect Browser'daki profiller. Kullanƒ±cƒ± zaten giri≈ü yapmƒ±≈ü
                olmalƒ±.</p>
        </div>

        <% if (error) { %>
            <div class="alert alert-error">
                <%= error %>
            </div>
            <% } %>
                <% if (success) { %>
                    <div class="alert alert-success">
                        <%= success %>
                    </div>
                    <% } %>

                        <div class="card">
                            <div class="card-header"
                                style="display:flex;justify-content:space-between;align-items:center">
                                <h3>Profil Senkronizasyonu</h3>
                                <div style="display:flex;gap:10px">
                                    <form action="/profiles/optimize" method="POST">
                                        <button type="submit" class="btn btn-warning">üßπ Kuyruƒüu Optimize Et</button>
                                    </form>
                                    <form action="/profiles/sync" method="POST">
                                        <button type="submit" class="btn btn-primary">üîÑ Vision'dan Senkronize
                                            Et</button>
                                    </form>
                                </div>
                            </div>
                            <div class="card-body">
                                <small style="color:#666">
                                    Vision Antidetect Browser'daki profilleri √ßeker. Her profil i√ßin Facebook'a manuel
                                    giri≈ü yapƒ±lmƒ±≈ü olmalƒ±dƒ±r.
                                </small>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3>Profil Listesi (<%= profiles.length %> adet)</h3>
                            </div>
                            <div class="card-body">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Profil Adƒ±</th>
                                            <th>Vision ID</th>
                                            <th>Durum</th>
                                            <th>Aktif G√∂rev / Kuyruk</th>
                                            <th>Beƒüenilen</th>
                                            <th>G√∂revler</th>
                                            <th>Son Senkr.</th>
                                            <th>ƒ∞≈ülemler</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% if (profiles.length===0) { %>
                                            <tr>
                                                <td colspan="8" class="text-center">
                                                    Hen√ºz profil yok. "Senkronize Et" butonuna basƒ±n.
                                                </td>
                                            </tr>
                                            <% } %>
                                                <% profiles.forEach(function(profile) { %>
                                                    <tr>
                                                        <td>
                                                            <%= profile.id %>
                                                        </td>
                                                        <td><strong>
                                                                <%= profile.name %>
                                                            </strong></td>
                                                        <td>
                                                            <code
                                                                style="font-size:0.75rem"><%= profile.visionId.substring(0, 8) %>...</code>
                                                        </td>
                                                        <td>
                                                            <span
                                                                class="status-badge <%= profile.status === 'active' ? 'success' : 'danger' %>">
                                                                <%= profile.status==='active' ? 'Aktif' : 'Devre Dƒ±≈üƒ±'
                                                                    %>
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <% if (profile.tasks && profile.tasks.length> 0) { %>
                                                                <% const task=profile.tasks[0]; %>
                                                                    <div class="active-task-wrapper">
                                                                        <span class="task-badge <%= task.status %>">
                                                                            <%= task.status==='processing' ? 'üîÑ' : '‚è≥'
                                                                                %>
                                                                                <%= task.taskType.toUpperCase() %>
                                                                        </span>
                                                                        <% if (task.target) { %>
                                                                            <div class="task-target-info"
                                                                                title="<%= task.target.url %>">
                                                                                <%= task.target.name ||
                                                                                    task.target.url.substring(0, 20)
                                                                                    + '...' %>
                                                                            </div>
                                                                            <% } %>
                                                                    </div>
                                                                    <% } else { %>
                                                                        <span class="text-muted"
                                                                            style="font-size: 0.8rem;">- Bo≈üta -</span>
                                                                        <% } %>
                                                        </td>
                                                        <td>
                                                            <a href="/profiles/<%= profile.id %>/likes" class="link">
                                                                <%= profile._count.likedTargets %> hedef
                                                            </a>
                                                        </td>
                                                        <td>
                                                            <%= profile._count.tasks %>
                                                        </td>
                                                        <td>
                                                            <% if (profile.lastSyncedAt) { %>
                                                                <%= new
                                                                    Date(profile.lastSyncedAt).toLocaleString('tr-TR')
                                                                    %>
                                                                    <% } else { %>
                                                                        -
                                                                        <% } %>
                                                        </td>
                                                        <td class="actions">
                                                            <form action="/profiles/toggle/<%= profile.id %>"
                                                                method="POST" style="display:inline">
                                                                <button type="submit"
                                                                    class="btn btn-sm <%= profile.status === 'active' ? 'btn-warning' : 'btn-primary' %>">
                                                                    <%= profile.status==='active' ? 'Devre Dƒ±≈üƒ±'
                                                                        : 'Aktifle≈ütir' %>
                                                                </button>
                                                            </form>
                                                            <form action="/profiles/delete/<%= profile.id %>"
                                                                method="POST" style="display:inline"
                                                                onsubmit="return confirm('Bu profili silmek istediƒüinize emin misiniz?')">
                                                                <button type="submit"
                                                                    class="btn btn-sm btn-danger">Sil</button>
                                                            </form>
                                                        </td>
                                                    </tr>
                                                    <% }); %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
    </main>

    <style>
        .active-task-wrapper {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .task-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            white-space: nowrap;
            width: fit-content;
        }

        .task-badge.pending {
            background-color: #fff3cd;
            color: #664d03;
            border: 1px solid #ffe69c;
        }

        .task-badge.processing {
            background-color: #cff4fc;
            color: #055160;
            border: 1px solid #9eeaf9;
        }

        .task-target-info {
            font-size: 0.75rem;
            color: #666;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
    </style>
</body>

</html>