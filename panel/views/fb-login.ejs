<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetaSal - Facebook Login</title>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <nav class="sidebar">
        <div class="sidebar-header">
            <h2>MetaSal</h2>
        </div>
        <ul class="nav-links">
            <li>
                <a href="/dashboard">ğŸ“Š Dashboard</a>
            </li>
            <li>
                <a href="/profiles">ğŸ–¥ï¸ Profiller</a>
            </li>
            <li>
                <a href="/targets">ğŸ“„ Gruplar/Sayfalar</a>
            </li>
            <li>
                <a href="/posts">ğŸ“ GÃ¶nderiler</a>
            </li>
            <li>
                <a href="/comments">ğŸ’¬ Yorumlar</a>
            </li>
            <li class="active">
                <a href="/fb-login">ğŸ” Facebook Login</a>
            </li>
        </ul>
        <div class="sidebar-footer">
            <a href="/logout" class="logout-btn">ğŸšª Ã‡Ä±kÄ±ÅŸ</a>
        </div>
    </nav>

    <main class="content">
        <div class="page-header">
            <h1>ğŸ” Facebook Login</h1>
            <p style="color: var(--gray-500); margin-top: 5px;">Toplu Facebook hesap doÄŸrulama ve Vision profil
                oluÅŸturma</p>
        </div>

        <!-- Ä°statistikler -->
        <div class="stats-grid">
            <div class="stat-card info">
                <div class="stat-icon">â³</div>
                <div class="stat-info">
                    <span class="stat-value">
                        <%= stats.pending %>
                    </span>
                    <span class="stat-label">Bekleyen</span>
                </div>
            </div>
            <div class="stat-card warning">
                <div class="stat-icon">ğŸ”„</div>
                <div class="stat-info">
                    <span class="stat-value">
                        <%= stats.processing %>
                    </span>
                    <span class="stat-label">Ä°ÅŸleniyor</span>
                </div>
            </div>
            <div class="stat-card success">
                <div class="stat-icon">âœ…</div>
                <div class="stat-info">
                    <span class="stat-value">
                        <%= stats.success %>
                    </span>
                    <span class="stat-label">BaÅŸarÄ±lÄ±</span>
                </div>
            </div>
            <div class="stat-card" style="border-left: 4px solid #ff9800;">
                <div class="stat-icon">ğŸª</div>
                <div class="stat-info">
                    <span class="stat-value">
                        <%= stats.cookieFailed %>
                    </span>
                    <span class="stat-label">Cookie HatalÄ±</span>
                </div>
            </div>
            <div class="stat-card danger">
                <div class="stat-icon">ğŸ”</div>
                <div class="stat-info">
                    <span class="stat-value">
                        <%= stats.loginFailed %>
                    </span>
                    <span class="stat-label">GiriÅŸ HatalÄ±</span>
                </div>
            </div>
            <div class="stat-card" style="border-left: 4px solid #9c27b0;">
                <div class="stat-icon">âš ï¸</div>
                <div class="stat-info">
                    <span class="stat-value">
                        <%= stats.needsVerify %>
                    </span>
                    <span class="stat-label">DoÄŸrulama Bekliyor</span>
                </div>
            </div>
        </div>

        <!-- Toplu Hesap Ekleme -->
        <div class="card">
            <div class="card-header">
                <h3>ğŸ“¥ Toplu Facebook Hesap Ekle</h3>
            </div>
            <div class="card-body">
                <form action="/fb-login/bulk-add" method="POST">
                    <div class="form-group">
                        <div style="margin-bottom: 10px;">
                            <label>VarsayÄ±lan Mobil Proxy HOST'u (Ä°steÄŸe baÄŸlÄ±)</label>
                            <input type="text" name="defaultProxyHost" class="form-control"
                                placeholder="Ã–rn: 192.168.1.10 (EÄŸer girilirse, IP'nin yanÄ±na |HOST olarak eklenir)"
                                style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>

                        <label>Format: kullanÄ±cÄ±adÄ±:ÅŸifre:cookie:IP (her satÄ±r bir hesap)</label>
                        <textarea name="accountsText" rows="8" placeholder="user1@mail.com:pass123:base64cookieburada:185.123.45.67
user2@mail.com:pass456::192.168.1.1
(cookie boÅŸ bÄ±rakÄ±labilir = sadece ÅŸifre ile giriÅŸ denenecek)"
                            style="font-family: monospace; font-size: 13px;"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">ğŸ“¤ HesaplarÄ± Ekle</button>
                </form>
            </div>
        </div>

        <!-- Ä°ÅŸlem KontrolÃ¼ -->
        <div class="card">
            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                <h3>ğŸ® Ä°ÅŸlem KontrolÃ¼</h3>
                <div style="display: flex; gap: 10px;">
                    <form action="/fb-login/retry-all-failed" method="POST" style="display: inline;">
                        <button type="submit" class="btn btn-warning btn-sm">ğŸ”„ HatalÄ±larÄ± Yeniden Dene</button>
                    </form>
                    <form action="/fb-login/clear-all" method="POST" style="display: inline;"
                        onsubmit="return confirm('TÃ¼m hesaplar silinecek. Emin misiniz?');">
                        <button type="submit" class="btn btn-danger btn-sm">ğŸ—‘ï¸ TÃ¼mÃ¼nÃ¼ Temizle</button>
                    </form>
                </div>
            </div>
            <div class="card-body">
                <p style="color: var(--gray-500); margin-bottom: 15px;">
                    Bot'u Facebook Login modunda baÅŸlattÄ±ÄŸÄ±nÄ±zda, bekleyen hesaplar sÄ±rayla iÅŸlenecektir.
                    <br>
                    <code
                        style="background: var(--gray-200); padding: 2px 6px; border-radius: 4px;">node src/facebookLoginHandler.js</code>
                </p>
            </div>
        </div>

        <!-- Ana Hesap Listesi (Pending, Processing, Success) -->
        <div class="card">
            <div class="card-header">
                <h3>ğŸ“‹ Hesap Listesi (<%= accounts.length %> hesap)</h3>
            </div>
            <div class="card-body" style="padding: 0;">
                <% if (accounts.length===0) { %>
                    <p style="padding: 20px; text-align: center; color: var(--gray-500);">HenÃ¼z hesap eklenmemiÅŸ veya
                        tÃ¼m hesaplar sorunlu bÃ¶lÃ¼mÃ¼nde.</p>
                    <% } else { %>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>KullanÄ±cÄ±</th>
                                    <th>Proxy IP</th>
                                    <th>Cookie</th>
                                    <th>Durum</th>
                                    <th>Vision ID</th>
                                    <th>Ä°ÅŸlemler</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% accounts.forEach((account, index)=> { %>
                                    <tr>
                                        <td>
                                            <%= index + 1 %>
                                        </td>
                                        <td style="font-family: monospace;">
                                            <%= account.username %>
                                        </td>
                                        <td style="font-family: monospace;">
                                            <%= account.proxyIP %>
                                        </td>
                                        <td>
                                            <% if (account.cookie) { %>
                                                <span class="status-badge success">Var</span>
                                                <% } else { %>
                                                    <span class="status-badge warning">Yok</span>
                                                    <% } %>
                                        </td>
                                        <td>
                                            <% if (account.status==='pending' ) { %>
                                                <span class="status-badge"
                                                    style="background: rgba(23, 162, 184, 0.15); color: #17a2b8;">â³
                                                    Bekliyor</span>
                                                <% } else if (account.status==='processing' ) { %>
                                                    <span class="status-badge warning">ğŸ”„ Ä°ÅŸleniyor</span>
                                                    <% } else if (account.status==='success' ) { %>
                                                        <span class="status-badge success">âœ… BaÅŸarÄ±lÄ±</span>
                                                        <% } else { %>
                                                            <span class="status-badge">
                                                                <%= account.status %>
                                                            </span>
                                                            <% } %>
                                        </td>
                                        <td style="font-family: monospace; font-size: 11px;">
                                            <%= account.visionId ? account.visionId.substring(0, 8) + '...' : '-' %>
                                        </td>
                                        <td class="actions">
                                            <form action="/fb-login/delete/<%= account.id %>" method="POST"
                                                style="display: inline;"
                                                onsubmit="return confirm('Bu hesabÄ± silmek istediÄŸinizden emin misiniz?');">
                                                <button type="submit" class="btn btn-danger btn-sm"
                                                    title="Sil">ğŸ—‘ï¸</button>
                                            </form>
                                        </td>
                                    </tr>
                                    <% }); %>
                            </tbody>
                        </table>
                        <% } %>
            </div>
        </div>

        <!-- Sorunlu Hesaplar BÃ¶lÃ¼mÃ¼ -->
        <% if (failedAccounts.length> 0) { %>
            <div class="card" style="border: 2px solid rgba(220, 53, 69, 0.3);">
                <div class="card-header"
                    style="background: linear-gradient(135deg, rgba(220, 53, 69, 0.1), rgba(255, 152, 0, 0.1)); display: flex; justify-content: space-between; align-items: center;">
                    <h3 style="color: #dc3545;">âš ï¸ Sorunlu Hesaplar (<%= failedAccounts.length %> hesap)</h3>
                    <div style="display: flex; gap: 10px;">
                        <form action="/fb-login/retry-all-with-password" method="POST" style="display: inline;">
                            <button type="submit" class="btn btn-sm"
                                style="background: linear-gradient(135deg, #ff9800, #f57c00); color: white;"
                                title="TÃ¼m cookie hatalÄ± hesaplarÄ± ÅŸifre ile dene">
                                ğŸ”‘ TÃ¼mÃ¼nÃ¼ Åifre ile Dene
                            </button>
                        </form>
                        <form action="/fb-login/retry-all-failed" method="POST" style="display: inline;">
                            <button type="submit" class="btn btn-warning btn-sm">ğŸ”„ TÃ¼mÃ¼nÃ¼ Yeniden Dene</button>
                        </form>
                        <form action="/fb-login/clear-failed" method="POST" style="display: inline;"
                            onsubmit="return confirm('TÃ¼m sorunlu hesaplar silinecek. Emin misiniz?');">
                            <button type="submit" class="btn btn-danger btn-sm">ğŸ—‘ï¸ SorunlularÄ± Temizle</button>
                        </form>
                    </div>
                </div>
                <div class="card-body" style="padding: 0;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>KullanÄ±cÄ±</th>
                                <th>Åifre</th>
                                <th>Proxy IP</th>
                                <th>Durum</th>
                                <th>Hata MesajÄ±</th>
                                <th>Deneme</th>
                                <th>Ä°ÅŸlemler</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% failedAccounts.forEach((account, index)=> { %>
                                <tr>
                                    <td>
                                        <%= index + 1 %>
                                    </td>
                                    <td style="font-family: monospace;">
                                        <%= account.username %>
                                    </td>
                                    <td style="font-family: monospace; color: #d63384;">
                                        <%= account.password %>
                                    </td>
                                    <td style="font-family: monospace;">
                                        <%= account.proxyIP %>
                                    </td>
                                    <td>
                                        <% if (account.status==='cookie_failed' ) { %>
                                            <span class="status-badge"
                                                style="background: rgba(255, 152, 0, 0.15); color: #ff9800;">ğŸª Cookie
                                                HatalÄ±</span>
                                            <% } else if (account.status==='login_failed' ) { %>
                                                <span class="status-badge danger">ğŸ” GiriÅŸ HatalÄ±</span>
                                                <% } else if (account.status==='needs_verify' ) { %>
                                                    <span class="status-badge"
                                                        style="background: rgba(156, 39, 176, 0.15); color: #9c27b0;">âš ï¸
                                                        DoÄŸrulama Gerekli</span>
                                                    <% } %>
                                    </td>
                                    <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
                                        title="<%= account.errorMessage || '' %>">
                                        <%= account.errorMessage || '-' %>
                                    </td>
                                    <td style="text-align: center;">
                                        <span class="status-badge"
                                            style="background: rgba(108, 117, 125, 0.15); color: #6c757d;">
                                            <%= account.retryCount %>x
                                        </span>
                                    </td>
                                    <td class="actions" style="white-space: nowrap;">
                                        <% if (account.status==='cookie_failed' && account.password) { %>
                                            <form action="/fb-login/retry-with-password/<%= account.id %>" method="POST"
                                                style="display: inline;">
                                                <button type="submit" class="btn btn-sm"
                                                    style="background: linear-gradient(135deg, #ff9800, #f57c00); color: white;"
                                                    title="Åifre ile Dene">
                                                    ğŸ”‘
                                                </button>
                                            </form>
                                            <% } %>
                                                <form action="/fb-login/retry/<%= account.id %>" method="POST"
                                                    style="display: inline;">
                                                    <button type="submit" class="btn btn-warning btn-sm"
                                                        title="Yeniden Dene">ğŸ”„</button>
                                                </form>
                                                <form action="/fb-login/delete/<%= account.id %>" method="POST"
                                                    style="display: inline;"
                                                    onsubmit="return confirm('Bu hesabÄ± silmek istediÄŸinizden emin misiniz?');">
                                                    <button type="submit" class="btn btn-danger btn-sm"
                                                        title="Sil">ğŸ—‘ï¸</button>
                                                </form>
                                    </td>
                                </tr>
                                <% }); %>
                        </tbody>
                    </table>
                </div>
            </div>
            <% } %>

    </main>

    <style>
        /* FB Login sayfasÄ± iÃ§in ek stiller */
        .card-body textarea {
            resize: vertical;
            min-height: 150px;
        }

        .data-table td {
            vertical-align: middle;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .status-badge.warning {
            animation: pulse 1.5s infinite;
        }

        /* Sorunlu hesaplar tablosu iÃ§in Ã¶zel stiller */
        .card[style*="border: 2px"] .data-table tr:hover {
            background: rgba(220, 53, 69, 0.05);
        }

        .actions form {
            margin: 0 2px;
        }
    </style>
</body>

</html>